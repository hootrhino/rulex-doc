(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{429:function(t,s,n){"use strict";n.r(s);var a=n(17),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"规则概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#规则概述"}},[t._v("#")]),t._v(" 规则概述")]),t._v(" "),n("p",[t._v("规则是 RULEX 的一个核心功能，即自定义数据处理逻辑和过程，在RULEX 里面我们使用 LUA 编程语言来描述规则。")]),t._v(" "),n("h2",{attrs:{id:"编程接口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编程接口"}},[t._v("#")]),t._v(" 编程接口")]),t._v(" "),n("p",[t._v("规则的编程接口为 "),n("code",[t._v("typex.Rule")]),t._v("：")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 规则描述")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Rule "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tId          "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"id"`')]),t._v("\n\tUUID        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"uuid"`')]),t._v("\n\tStatus      RuleStatus  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"status"`')]),t._v("\n\tName        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"name"`')]),t._v("\n\tFrom        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"from"`')]),t._v("\n\tActions     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"actions"`')]),t._v("\n\tSuccess     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"success"`')]),t._v("\n\tFailed      "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"failed"`')]),t._v("\n\tDescription "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"description"`')]),t._v("\n\tVM          "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("lua"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LState "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"-"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("h2",{attrs:{id:"字段说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#字段说明"}},[t._v("#")]),t._v(" 字段说明")]),t._v(" "),n("ul",[n("li",[t._v("Id：\nSqlite 使用的ID")]),t._v(" "),n("li",[t._v("UUID\n：用户接口ID")]),t._v(" "),n("li",[t._v("Status\n：状态")]),t._v(" "),n("li",[t._v("Name\n：名称")]),t._v(" "),n("li",[t._v("From\n：数据来源，也就是关联的资源")]),t._v(" "),n("li",[t._v("Actions\n：规则处理关键逻辑，是LUA程序")]),t._v(" "),n("li",[t._v("Success\n：执行成功后的回调")]),t._v(" "),n("li",[t._v("Failed\n：执行失败后的回调")]),t._v(" "),n("li",[t._v("Description\n：文本描述")]),t._v(" "),n("li",[t._v("VM\n：LUA沙箱虚拟机")])]),t._v(" "),n("h2",{attrs:{id:"案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例"}},[t._v("#")]),t._v(" 案例")]),t._v(" "),n("p",[t._v("下面展示一个解析PLC数据的简单规则定义:")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewRule")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("engine"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"uuid"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Just a test"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Just a test"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("grpcInend"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UUID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`function Success() print("[LUA Success Callback]=> OK") end`')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`\n\tActions = {\n\t\tfunction(data)\n\t\t\tlocal V0 = rulexlib:MB(\">a:16 b:16 c:16 d:16 e:16\", data, false)\n\t\t\tlocal a = rulexlib:T2J(V0['a'])\n\t\t\tlocal b = rulexlib:T2J(V0['b'])\n\t\t\tlocal c = rulexlib:T2J(V0['c'])\n\t\t\tlocal d = rulexlib:T2J(V0['d'])\n\t\t\tlocal e = rulexlib:T2J(V0['e'])\n\t\t\tprint('a ==> ', a, ' ->', rulexlib:BS2B(a), '==> ', rulexlib:B2I64('>', rulexlib:BS2B(a)))\n\t\t\tprint('b ==> ', b, ' ->', rulexlib:BS2B(a), '==> ', rulexlib:B2I64('>', rulexlib:BS2B(b)))\n\t\t\tprint('c ==> ', c, ' ->', rulexlib:BS2B(a), '==> ', rulexlib:B2I64('>', rulexlib:BS2B(c)))\n\t\t\tprint('d ==> ', d, ' ->', rulexlib:BS2B(a), '==> ', rulexlib:B2I64('>', rulexlib:BS2B(d)))\n\t\t\tprint('e ==> ', e, ' ->', rulexlib:BS2B(a), '==> ', rulexlib:B2I64('>', rulexlib:BS2B(e)))\n\t\t\treturn true, data\n\t\tend\n\t}`")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`function Failed(error) print("[LUA Failed Callback]", error) end`')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);